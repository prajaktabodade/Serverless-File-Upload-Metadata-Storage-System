import json
import boto3
import uuid
from datetime import datetime

s3 = boto3.client('s3')
dynamodb = boto3.resource('dynamodb')

BUCKET_NAME = "file-upload-lab-yourname"
TABLE_NAME = "FileMetadata"

table = dynamodb.Table(TABLE_NAME)

def lambda_handler(event, context):
    file_id = str(uuid.uuid4())
    file_name = event["fileName"]
    file_content = event["fileContent"]

    # Upload file to S3
    s3.put_object(
        Bucket=BUCKET_NAME,
        Key=file_name,
        Body=file_content
    )

    # Store metadata in DynamoDB
    table.put_item(
        Item={
            "fileId": file_id,
            "fileName": file_name,
            "uploadTime": datetime.utcnow().isoformat()
        }
    )

    return {
        "statusCode": 200,
        "body": json.dumps("File uploaded successfully")
    }
